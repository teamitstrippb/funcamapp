<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Camera Games</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #222;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .screen {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100vh;
  }
  .active {
    display: flex;
  }
  button {
    margin: 10px;
    padding: 10px 20px;
    font-size: 18px;
    border-radius: 10px;
    cursor: pointer;
  }
  canvas {
    border-radius: 20px;
    margin-top: 20px;
  }
</style>
</head>
<body>

<!-- Screen 1: Camera Access -->
<div id="screen1" class="screen active">
  <h1>Allow Camera Access ðŸŽ¥</h1>
  <button id="allowCamera">Allow Camera</button>
</div>

<!-- Screen 2: Game Menu -->
<div id="screen2" class="screen">
  <h1>Camera Games</h1>
  <button id="startGame">Start Hand Game</button>
</div>

<!-- Screen 3: Game -->
<div id="screen3" class="screen">
  <h1>Catch the Falling Circles!</h1>
  <canvas id="gameCanvas" width="640" height="480"></canvas>
  <p>Move your hand/finger to catch the circles!</p>
  <button id="backMenu">Back to Menu</button>
</div>

<script>
let video;
let handX = 320, handY = 240; // default position
let circles = [];
let score = 0;

// Screens
const screen1 = document.getElementById('screen1');
const screen2 = document.getElementById('screen2');
const screen3 = document.getElementById('screen3');

// Switch screens
function showScreen(screen) {
  [screen1, screen2, screen3].forEach(s => s.classList.remove('active'));
  screen.classList.add('active');
}

// Screen 1: Allow Camera
document.getElementById('allowCamera').addEventListener('click', () => {
  navigator.mediaDevices.getUserMedia({ video: true, audio: false })
    .then(stream => {
      video = document.createElement('video');
      video.srcObject = stream;
      video.play();
      showScreen(screen2);
    })
    .catch(err => alert('Camera access denied: ' + err));
});

// Screen 2: Start Game
document.getElementById('startGame').addEventListener('click', () => {
  showScreen(screen3);
  initGame();
});

// Screen 3: Back to menu
document.getElementById('backMenu').addEventListener('click', () => {
  showScreen(screen2);
});

// --- Hand Game ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function initGame() {
  circles = [];
  score = 0;
  for(let i=0; i<5; i++){
    circles.push({x: Math.random()*canvas.width, y: Math.random()*-500, r: 20 + Math.random()*20, speed: 2 + Math.random()*3});
  }
  requestAnimationFrame(gameLoop);
}

// Simple hand detection: detect bright spot in video (like fingertip)
// Advanced: integrate MediaPipe Hands for real tracking
function detectHand() {
  if (!video) return;
  const tempCanvas = document.createElement('canvas');
  tempCanvas.width = video.videoWidth;
  tempCanvas.height = video.videoHeight;
  const tempCtx = tempCanvas.getContext('2d');
  tempCtx.drawImage(video, 0, 0);
  const frame = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
  let maxBrightness = 0;
  let x=handX, y=handY;

  for (let i=0; i<frame.data.length; i+=4) {
    const r = frame.data[i], g = frame.data[i+1], b = frame.data[i+2];
    const brightness = r+g+b;
    if (brightness > maxBrightness) {
      maxBrightness = brightness;
      const index = i/4;
      x = index % frame.width;
      y = Math.floor(index / frame.width);
    }
  }
  handX = x * (canvas.width / tempCanvas.width);
  handY = y * (canvas.height / tempCanvas.height);
}

function gameLoop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  detectHand();

  // Draw hand
  ctx.fillStyle = 'red';
  ctx.beginPath();
  ctx.arc(handX, handY, 20, 0, Math.PI*2);
  ctx.fill();

  // Draw and update circles
  ctx.fillStyle = 'yellow';
  circles.forEach(c => {
    c.y += c.speed;
    ctx.beginPath();
    ctx.arc(c.x, c.y, c.r, 0, Math.PI*2);
    ctx.fill();

    // Collision
    const dx = c.x - handX;
    const dy = c.y - handY;
    if(Math.sqrt(dx*dx + dy*dy) < c.r + 20){
      score++;
      c.y = -50;
      c.x = Math.random() * canvas.width;
    }

    if(c.y > canvas.height + 50){
      c.y = -50;
      c.x = Math.random() * canvas.width;
    }
  });

  // Score
  ctx.fillStyle = 'white';
  ctx.font = '20px sans-serif';
  ctx.fillText('Score: ' + score, 10, 30);

  requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
